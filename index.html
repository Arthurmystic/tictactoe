<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width" , initial-scale="1.0">
    <title> TicTacToeGame</title>
    <link rel="stylesheet" href="style.css">

</head>

<body>
    <h1> Tic Tac Toe Game</h1>
    <div id="game">

        <div id="game-container">
            <div class="cell" data-val="1"> </div>
            <div class="cell" data-val="2"> </div>
            <div class="cell" data-val="3"> </div>
            <div class="cell" data-val="4"> </div>
            <div class="cell" data-val="5"> </div>
            <div class="cell" data-val="6"> </div>
            <div class="cell" data-val="7"> </div>
            <div class="cell" data-val="8"> </div>
            <div class="cell" data-val="9"> </div>
        </div>
        <dialog modal>
            <fieldset>
                <legend> GAME OVER </legend>
                <div id="results"> </div>
            </fieldset>


        </dialog>

    </div>


    <!-- <script src=scritpt.css> </script> -->
    <script>
        const docQuery = (function () {
            const gameContainer = document.querySelector("#game-container");
            const cellDiv = document.querySelectorAll(".cell");
            const resultsDiv = document.querySelector("#results");
            return { gameContainer, cellDiv, resultsDiv };
        }());

        function createPlayer(name, marker) {
            return {
                name,
                marker,
                moves: [],
                playedCells: [],
            };
        }

        const gameController = (function () {
            const playerOne = createPlayer(prompt('Enter player 1 name'), 'X');
            const playerTwo = createPlayer(prompt('Enter player 2 name'), 'O');
            const { playedCells } = createPlayer(); // this is for learning 
            // — I don’t actually need `playedCells` to be part of `createPlayer`.
            // I could have simply declared `let playedCells = []` here in gameController
            // instead. I left it inside `createPlayer` just to demonstrate
            // how destructuring works when returning objects.

            let currentRound = 1
            const getCurrentRound = () => currentRound;
            const incrementRound = () => currentRound++;

            return { playerOne, playerTwo, getCurrentRound, incrementRound, playedCells }

        }());


        function getClickedCellData(e) {
            let cellValue = e.target.dataset.val;
            // const cellValue = () => userInput;
            // return {userInput}; this exposes userInput
            return { cellValue }; // Return the selected cell as private data
        }


        function markCell(marker, cellIndex) {
            const cellID = Number(cellIndex)
            docQuery.cellDiv[cellID - 1].textContent = marker
        }

        function gameFlow(e) {
            const { cellValue } = getClickedCellData(e);
            let player;
            if (gameController.playedCells.includes(cellValue)) {
                alert('Cell already marked! Pick an empty one.');
                // getClickedCellData(e);

            } else {
                gameController.playedCells.push(cellValue);
                console.log(cellValue, typeof (cellValue));

                if (gameController.getCurrentRound() % 2 == 1) {
                    player = gameController.playerOne;
                } else {
                    player = gameController.playerTwo;
                }

                player.moves.push(cellValue);
                markCell(player.marker, cellValue);
                const results = checkWinner(player.name, player.moves);

                gameController.incrementRound();
            }
        }

        function getWinningCombinations() {
            return [
                [1, 2, 3], [4, 5, 6], [7, 8, 9],
                [1, 4, 7], [2, 5, 8], [3, 6, 9],
                [1, 5, 9], [3, 5, 7]
            ];
        };

        function checkWinner(playerName, playerMoves) {
            const moves = playerMoves.map(Number); // values in playerMoves are strings. this converts them to numbers
            const name = playerName.toUpperCase();
            let winnerIsFound = false;
            if (moves.length > 2) {
                for (const subArray of getWinningCombinations()) {
                    if (subArray.every(num => moves.includes(num))) {
                        console.log(` -- ${name} WINS -- `);
                        winnerIsFound = true;
                        docQuery.gameContainer.removeEventListener('click', gameFlow);
                        return ` -- ${name} WINS -- `
                        break; // exit loop
                    }
                }
            }

            if (!winnerIsFound && gameController.getCurrentRound() === 9) {
                console.log(` -- It's a DRAW -- `);
                return ` -- It's a DRAW -- `
                docQuery.gameContainer.removeEventListener('click', gameFlow);
            }
        }

        docQuery.gameContainer.addEventListener('click', gameFlow)

    </script>
</body>

</html>