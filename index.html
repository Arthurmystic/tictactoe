<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width" , initial-scale="1.0">
    <title> TicTacToeGame</title>
    <link rel="stylesheet" href="style.css">

</head>

<body>
    <h1> Tic Tac Toe Game</h1>
    <div id="game"></div>

    <div id="game-container">
        <div class="cell" data-val="1">1</div>
        <div class="cell" data-val="2">2</div>
        <div class="cell" data-val="3">3</div>
        <div class="cell" data-val="4">4</div>
        <div class="cell" data-val="5">5</div>
        <div class="cell" data-val="6">6</div>
        <div class="cell" data-val="7">7</div>
        <div class="cell" data-val="8">8</div>
        <div class="cell" data-val="9">9</div>
    </div>


    <!-- <script src=scritpt.css> </script> -->
    <script>

        const docQuery = (function () {
            const gameContainer = document.querySelector("#game-container");
            return { gameContainer }
        }());

        function createPlayer(name, marker){
            return { name, 
                marker, 
                moves:[] };
        }  
        
        const players = (function () {
            
            const playerOne = createPlayer(prompt('Enter player 1 name'), 'X');
            const playerTwo = createPlayer(prompt('Enter player 2 name'), 'O');

            let currentRound = 1
            const getCurrentRound =()=> currentRound;
            const incrementRound = () => currentRound++;

            return { playerOne, playerTwo, getCurrentRound, incrementRound }

        }());

        function getClickedCellData(e) {
            let cellValue = e.target.dataset.val;
            // const cellValue = () => userInput;
            // return {userInput}; this exposes userInput
            return { cellValue }; // this maintains it as a private var.
        }

        function getWinningCombinations() {
            return [
                [1, 2, 3], [4, 5, 6], [7, 8, 9],
                [1, 4, 7], [2, 5, 8], [3, 6, 9],
                [1, 5, 9], [3, 5, 7]
            ];
        };

        docQuery.gameContainer.addEventListener('click', gameFlow)

        function gameFlow(e) {
            const { cellValue } = getClickedCellData(e);
            
            console.log(cellValue)
            if (players.getCurrentRound() % 2 == 1) {
                players.playerOne.moves.push(cellValue)
                checkWinner(players.playerOne.name, players.playerOne.moves)
            } else {
                players.playerTwo.moves.push(cellValue)
                checkWinner(players.playerTwo.name, players.playerTwo.moves)
            }

            players.incrementRound();
        }

        function checkWinner(playerName, playerMoves) {
            const moves = playerMoves.map(Number); // values in playerMoves are strings. this converts them to numbers
            const name = playerName.toUpperCase();
            let winnerIsFound = false;
            if (moves.length > 2) {
                for (const subArray of getWinningCombinations()) {
                    if (subArray.every(num => moves.includes(num))) {
                        console.log(` -- ${name} WINS -- `);
                        winnerIsFound = true;
                        docQuery.gameContainer.removeEventListener('click', gameFlow);
                        break; // exit loop
                    }
                }
            }
            if (!winnerIsFound && players.getCurrentRound() === 9){
                        console.log(` -- It's a DRAW -- `);
                        docQuery.gameContainer.removeEventListener('click', gameFlow);
                    }
        }

    </script>
</body>

</html>